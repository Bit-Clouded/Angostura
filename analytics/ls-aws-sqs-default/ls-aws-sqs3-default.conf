input {
	sqs {
		queue => "{{sqs-name}}"
		region => "{{aws-region}}"
	}
}

filter {
	
	if [TopicArn] == "{{critical-events}}" or [TopicArn] == "{{warning-events}}" {
		
		mutate {
			rename => { "[MessageId]" => "event_unique_id" }		
		}
		
		json {
			source => "Message"
			
			add_field => ["index_name", "cloudwatch-alarms"]
			
			remove_field => "Message"
			remove_field => "Notification"
			remove_field => "Signature"
			remove_field => "SigningCertURL"
			remove_field => "UnsubscribeURL"
		}
	}
}

output {
	if [index_name] {
		elasticsearch {
			hosts => ["{{es-host}}"]
			index => "logstash-{{sqs-name-lowercase}}-%{[index_name]}-%{+YYYY.MM.dd}"
			document_id => '%{[event_unique_id]}'
		}
	}
}
